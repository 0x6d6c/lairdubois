{% extends 'LadbCoreBundle:Common:Layout/_show.html.twig' %}

{% use 'LadbCoreBundle:Common:map.blocks.html.twig' %}

{% set entity = offer %}

{% set pageTitleBy = 'trouv√© par' %}
{% set noMicrodataLocation = false %}
{% set pageSectionUrl = url('core_offer_list') %}
{% set pageSectionName = 'offer.offer.list'|trans %}

{% set navSection = 'offers' %}
{% set searchPath = path('core_offer_list') %}

{% set ownerUser = is_granted("ROLE_USER") and app.user.id == offer.user.id %}

{% block headStylesheets %}
    {{ parent() }}
    {% if hasMap %}
        {{ block('mapAreaStylesheets') }}
    {% endif %}
{% endblock %}

{% block bodyJavascripts %}
    {{ parent() }}
    {% if hasMap %}
        {{ block('mapAreaJavascripts') }}
    {% endif %}
{% endblock %}

{% block bodyHeaderContainerContent %}
    {% include 'LadbCoreBundle:Common/Header:_entity-show-header.part.html.twig' %}
{% endblock %}

{% block contentBody %}
    {% if offer.isDraft %}
        {% include 'LadbCoreBundle:Offer/Offer:_draft-alert.part.html.twig' %}
    {% endif %}
    <div class="ladb-offer">
        <div class="row">
            <div class="col-xs-12">
                {% include 'LadbCoreBundle:Core/Picture:_img-link.part.html.twig' with { 'picture':offer.pictures[0], 'width':'600', 'height':'600', 'filterMode':'i', 'alt':offer.title, 'aClasses':(offer.pictures.count > 1 ? 'ladb-margin-bottom' : '') } %}
            </div>
            {% if offer.pictures.count > 1 %}
                {% for index in 1..4 %}
                    <div class="col-xs-3">
                        {% if index < offer.pictures.count %}
                            {% include 'LadbCoreBundle:Core/Picture:_img-link.part.html.twig' with { 'picture':offer.pictures[index], 'width':'128', 'height':'128', 'alt':offer.title, 'attributes':'data-pin-nopin="true"' } %}
                        {% else %}
                            <span class="thumbnail thumbnail-empty"><img src="{{ 'empty.png'|imagine_filter('128x128o') }}" data-pin-nopin="true"></span>
                        {% endif %}
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        {% if offer.location is defined and offer.location is not null %}
            <div class="ladb-link">
                <i class="ladb-icon-location ladb-icon-fixed-center"></i>
                    {% if not noMicrodataLocation %}
                        <span itemprop="location" itemscope itemtype="http://schema.org/Place">
                            <span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
                    {% endif %}
                            {% if not noMicrodataLocation %}<span itemprop="addressLocality">{% endif %}{{ offer.location ? offer.location : '-' }}{% if not noMicrodataLocation %}</span>{% endif %}
                    {% if not noMicrodataLocation %}
                            </span>
                        </span>
                    {% endif %}
            </div>
        {% endif %}
        <hr>
        <div class="ladb-body">
            {% for block in offer.bodyBlocks %}
                {% include 'LadbCoreBundle:Core/Block:_show-'~block.strippedName~'.part.html.twig' %}
            {% endfor %}
        </div>
    </div>
    {% if offer.updatedAt > offer.createdAt %}
        {% include 'LadbCoreBundle:Common:_updated-age.part.html.twig' with { 'entity':offer } %}
    {% endif %}
    {% if not ownerUser %}
        {% include 'LadbCoreBundle:Common:_like-and-follow.part.html.twig' %}
    {% endif %}
    {% include 'LadbCoreBundle:Core/Comment:_widget.part.html.twig' %}
{% endblock %}

{% block contentMetasPanel %}
    <div class="ladb-metas">
        {% include 'LadbCoreBundle:Common:_meta-like-counter.part.html.twig' %}
        {% include 'LadbCoreBundle:Common:_meta-view-counter.part.html.twig' %}
        {% include 'LadbCoreBundle:Common:_meta-comment-counter.part.html.twig' %}
        {% if hasMap %}
            <div class="ladb-meta">
                {% if hasMap %}
                    {% include 'LadbCoreBundle:Common:_map-area.part.html.twig' with { 'autoInit':true, 'mapHeight':'150px', 'markersUrl':path('core_offer_location', { 'id':offer.id }), 'classes':'ladb-map-thumbnail ladb-margin-top' } %}
                {% endif %}
            </div>
        {% endif %}
    </div>
    {% include 'LadbCoreBundle:Core/Tag:_metas.part.html.twig' with { 'tags':offer.tags, 'type':'offers' } %}
{% endblock %}

{% block contentSuggests %}
    {% if userOffers is not empty %}
        <div class="panel panel-default">
            <div class="panel-heading">
                {{ ('offer.offer.other_from')|trans() }} {% include 'LadbCoreBundle:Core/User:_displayname-link.part.html.twig' with { 'user':offer.user, 'noMicrodata':true } %}
            </div>
            <div class="panel-body row">
                {% for userOffer in userOffers %}
                    <div class="col-xs-6">
                        {% include 'LadbCoreBundle:Offer/Offer:_thumbnail-link.part.html.twig' with { 'offer':userOffer } %}
                    </div>
                {% endfor %}
                {% if offer.user.meta.publicOfferCount > 2 %}
                    <div class="col-xs-12 ladb-margin-top">
                        <a href="{{ path('core_user_show_offers', { 'username':offer.user.usernamecanonical}) }}" class="btn btn-link btn-xs">{{ 'default.see_more'|trans() }}</a>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% if similarOffers is not null %}
        <div class="panel panel-default">
            <div class="panel-heading">
                {{ ('offer.offer.similar')|trans() }}
            </div>
            <div class="panel-body row">
                {% for similarOffer in similarOffers %}
                    <div class="col-xs-6">
                        {% include 'LadbCoreBundle:Offer/Offer:_thumbnail-link.part.html.twig' with { 'offer':similarOffer, 'classes':(loop.last ? null : 'ladb-margin-bottom') } %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endblock %}
